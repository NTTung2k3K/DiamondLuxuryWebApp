@using DiamondLuxurySolution.Data.Entities
@using DiamondLuxurySolution.ViewModel.Common
@using DiamondLuxurySolution.ViewModel.Models.Product

@model PageResult<ProductVm>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var keyword = ViewData["Keyword"]?.ToString().ToLower();
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
	.product-item {
		background-color: #343434;
		border: none;
		text-align: center;
		border-radius: 4px;
		height: 400px;
		width: 280px;
		margin: 0px 5px;
		padding: 0px;
		margin-bottom: 10px;
	}

	.item-img {
		width: 100%;
		height: 310px;
		overflow: hidden;
		padding: 10px;
		position: relative;
	}

		.item-img img {
			width: 100%;
			height: 100%;
		}

	.product-link {
		display: block;
		text-decoration: none;
		color: inherit;
	}

	.item-content {
		transition: transform 0.3s;
	}

		.item-content:hover {
			transform: scale(1.0);
		}
	/*NameProduct*/
	.CategoryProduct {
		margin-bottom: 2px;
		font-size: 14px;
		font-family: "Jura", cursive;
		font-optical-sizing: auto;
		white-space: nowrap;
		overflow: hidden;
	}

	/*Id Product*/
	.IdProduct {
		background: #E8BE6F
	}

		.IdProduct h9 {
			color: black;
			font-size: 20px;
			font-weight: 0;
			font-family: "Source Code Pro", monospace;
		}
	/*price*/
	.item-price {
		font-weight: bold;
		color: #E8BE6F;
		font-weight: 600;
		font-size: 18px;
		margin-top: 6px;
		font-family: "Jura", monospace;
		font-weight: bold;
		display: flex;
		justify-content: center
	}

</style>


<div class="wrapper bg--shaft" style="background-color: black;">
    <header class="header headery-style-1">
        <div class="breadcrumb-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        Kết quả hiển thị cho từ khóa: "@keyword"
                    </div>
                    <div class="col-12 text-center">
                        <h1 class="page-title">Tìm Kiếm Thông Tin</h1>
                        <ul class="breadcrumb justify-content-center">
                            <li><a href="trangchu.html">Trang Chủ</a></li>
                            <li class="current"><a href="/Search/Index">Tìm kiếm</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>
</div>

<!-- Main Content Wrapper Start -->
<div class="main-content-wrapper" style="background-color:black">
	<div class="shop-area pt--40 pb--80 pt-md--30 pb-md--60">
		<div class="container">
						<div class="child-cat row row-small align-equal">
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryBracelet/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/icon-vong-tay-kim-cuong.png" alt="product" >
								</div>
								<h2 class="cat-name">Vòng Tay Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryEarring/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/bong-tai.png" alt="product" >
								</div>
								<h2 class="cat-name">Hoa Tai Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryNecklace/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/i-mat-day-chuyen-kim-cuong.png" alt="product" >
								</div>
								<h2 class="cat-name">Mặt Dây Chuyền Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/WeddingJewelryRing/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/nhan-cuoi.png" alt="product" >
								</div>
								<h2 class="cat-name">Nhẫn Cưới Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/WeddingJewelryProposal/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/nhan-kim-cuong-cau-hon.png" alt="product" >
								</div>
								<h2 class="cat-name">Nhẫn Kim Cương Cầu Hôn</h2>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div class="child-cat row row-small align-equal">
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryRing/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/nhan-kc.png" alt="product" >
								</div>
								<h2 class="cat-name">Nhẫn Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryRingMan/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/nhan-nam.png" alt="product" >
								</div>
								<h2 class="cat-name">Nhẫn Kim Cương Nam</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryRingWoman/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/nhan-kim-cuong-nu.png" alt="product" >
								</div>
								<h2 class="cat-name">Nhẫn Kim Cương Nữ</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/WeddingJewelry/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/trang-suc-cuoi.png" alt="product" >
								</div>
								<h2 class="cat-name">Trang Sức Cưới</h2>
							</a>
						</div>
					</div>
				</div>
				<div class="col large-2 medium-4 small-6">
					<div class="col-inner">
						<div class="cat-item text-center">
							<a href="/DiamondJewelryBangles/Index">
								<div class="cat-img">
									<img src="assets/img/pic_product/search/trang-suc-kim-cuong-chd.png" alt="product" >
								</div>
								<h2 class="cat-name">Lắc Tay Kim Cương</h2>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="justify-content: center;">
				<div class="col-lg-12">
					<div class="row">
						<div class="col-12">
							<!-- Refine Search Start -->
							<style>
								.refine-search {
									display: flex;
									justify-content: center;
									/* Căn giữa theo chiều ngang */
									align-items: center;
									/* Căn giữa theo chiều dọc */
								}

								.nice-select {
									width: 250px;
									display: inline-block;
									padding-top: 5px;
								}

									.nice-select option {
										padding: 10px;
										font-size: 16px;
										width: 250px;
									}

								.pagination-wrap {
									display: flex;
									justify-content: center;
									align-items: center;
								}

								#seeMoreBtn {
									background-color: transparent;
									border: 1px solid white; /* Border color */
									color: white; /* Text color */
									cursor: pointer;
									border-radius: 10px;
									transition: all 0.3s ease;
								}

									#seeMoreBtn:hover {
										background-color: #a8741a; /* Hover background color */
										color: #ffffff; /* Hover text color */
									}

								.hidden {
									display: none !important;
								}
							</style>
							<div class="refine-search mb--30">
								<ul class="cat-list mb--20">
									<style>
										.link-border {
											border: 1px solid #ffffff;
											/* Màu và độ dày của viền */
											padding: 10px;
											/* Khoảng cách giữa viền và nội dung liên kết */
											text-decoration: none;
											margin: 10px;
											/* Loại bỏ gạch chân mặc định của liên kết */
										}
									</style>
								</ul>
							</div>
							<!-- Refine Search End -->
							<!-- Shop Toolbar Start -->

							<div class="shop-toolbar">
								<div class="product-short" style="width: 250px; text-align-last: center; display: flex; align-items: center; justify-content: center;">
									<select id="gemFilter" class=" nice-select">
										<option value="">Đá Đính Kèm</option>
										<option value="Kim Cương">Kim Cương</option>
										<option value="Đá CZ">Đá CZ</option>
										<option value="Đá Ruby">Đá Ruby</option>
										<option value="Đá Sapphire">Đá Sapphire</option>
									</select>
								</div>
								<div class="product-short" style="width: 250px; text-align-last: center; display: flex; align-items: center; justify-content: center;">
									<select id="priceFilter" class="nice-select">
										<option value="">Giá</option>
										<option value="10000000">Dưới 10,000,000</option>
										<option value="10000000-30000000">10,000,000-30,000,000</option>
										<option value="30000000-50000000">30,000,000-50,000,000</option>
										<option value="50000000-100000000">50,000,000-100,000,000</option>
										<option value="100000000">Trên 100,000,000</option>
									</select>
								</div>
								<div class="searchBox">
									<input class="searchInput" type="text" name="searchQuery" placeholder="Tìm Kiếm Nhanh..." id="searchInput">
								</div>
							</div>
						</div>

						<!-- Shop Toolbar End -->
					</div>
				</div>

				<!-- Main Shop wrapper Start -->
				<div class="col-12" style="display: flex; flex-wrap: wrap;">
					@if (Model != null && Model.Items != null && Model.Items.Count > 0)
					{
						var filteredProducts = Model.Items;

						// Lọc sản phẩm theo keyword
						if (!string.IsNullOrEmpty(keyword))
						{
							filteredProducts = filteredProducts.Where(p => p.ProductName.ToLower().Contains(keyword.ToLower()) || (p.CategoryVm?.CategoryName.ToLower().Contains(keyword.ToLower()) ?? false)).ToList();
						}
						// Sản phẩm được hiển thị ban đầu
						var initialProducts = filteredProducts.Take(2).ToList();
						var hiddenProducts = filteredProducts.Skip(2).ToList();

						@foreach (var product in initialProducts)
							{
								<div class="item product-item col-3" data-gem="@product.GemVm.GemName" data-price="@product.SellingPrice">
									<div class="item-content">
										<a href="/DiamondJewelry/Detail?ProductId=@product.ProductId">
											<div class="item-img">
												<img src="@product.ProductThumbnail" alt="@product.ProductName" class="primary-image" />
												<div style="position: absolute; top: 6%; margin-left: 8px;">
													@if (product.IsSale && product.PercentSale != 0)
													{
														<span class="product-label discount" style="padding: 5px 10px">
															-@product.PercentSale%
														</span>
													}
												</div>
											</div>
										</a>
										<div class="item-text">
											<p class="CategoryProduct" style="margin-bottom: 4px">
												@product.CategoryVm.CategoryName
											</p>
											<div class="IdProduct">
												<h9>
													<a href="/DiamondJewelry/Detail?ProductId=@product.ProductId" style="color: black">
														@product.ProductName
													</a>
												</h9>
											</div>
											<div class="item-price">
												<div class="product-price-wrapper">
													<span class="money" style="color: #E8BE6F;">@product.SellingPrice.ToString("N0")₫</span>
													@if (product.OriginalPrice != product.SellingPrice)
													{
														<span class="product-price-old">
															<span class="money">@product.OriginalPrice.ToString("N0")₫</span>
														</span>
													}
												</div>
											</div>
										</div>

									</div>
								</div>
							}

						// Sản phẩm ẩn
						@foreach (var product in hiddenProducts)
							{
								<div class="item product-item hidden col-3" data-gem="@product.GemVm.GemName" data-price="@product.SellingPrice">
									<div class="item-content">
										<a href="/DiamondJewelry/Detail?ProductId=@product.ProductId">
											<div class="item-img">
												<img src="@product.ProductThumbnail" alt="@product.ProductName" class="primary-image" />
												<div style="position: absolute; top: 6%; margin-left: 8px;">
													@if (product.IsSale && product.PercentSale != 0)
													{
														<span class="product-label discount" style="padding: 5px 10px">
															-@product.PercentSale%
														</span>
													}
												</div>
											</div>
										</a>
										<div class="item-text">
											<p class="CategoryProduct" style="margin-bottom: 4px">
												@product.CategoryVm.CategoryName
											</p>
											<div class="IdProduct">
												<h9>
													<a href="/DiamondJewelry/Detail?ProductId=@product.ProductId" style="color: black">
														@product.ProductName
													</a>
												</h9>
											</div>
											<div class="item-price">
												<div class="product-price-wrapper">
													<span class="money" style="color: #E8BE6F;">@product.SellingPrice.ToString("N0")₫</span>
													@if (product.OriginalPrice != product.SellingPrice)
													{
														<span class="product-price-old">
															<span class="money">@product.OriginalPrice.ToString("N0")₫</span>
														</span>
													}
												</div>
											</div>
										</div>

									</div>
								</div>
							}
						}
						else
						{
							<h1>Không có sản phẩm nào phù hợp với từ khóa "@keyword"</h1>
						}
				</div>


				<!-- Main Shop wrapper End -->
				<!-- Pagination Start -->
				@if (Model.Items.Count > 20)
				{
						<div class="see-more-wrapper text-center mt-4">
							<button id="seeMoreBtn" class="btn btn-primary">Xem thêm</button>
						</div>
				}
				<!-- Pagination End -->
			</div>
		</div>
	</div>
</div>
<!-- Main Content Wrapper End -->


<script>
	$(document).ready(function () {
		$('#seeMoreBtn').on('click', function () {
			$('.product-item.hidden').slice(0, 20).removeClass('hidden');
			if ($('.product-item.hidden').length === 0) {
				$('#seeMoreBtn').hide();
			}
		});

		function filterProducts() {
			var gem = $('#gemFilter').val().toLowerCase();
			var price = $('#priceFilter').val();
			var searchQuery = $('#searchInput').val().toLowerCase();


			$('.product-item').each(function () {
				var productGem = $(this).data('gem').toLowerCase();
				var productPrice = parseFloat($(this).data('price'));
				var productName = $(this).find('.product-content h4').text().toLowerCase();

				var showProduct = true;

				if (gem && !productGem.includes(gem)) {
					showProduct = false;
				}

				if (price) {
					if (price === '10000000') { // Dưới 10,000,000
						if (productPrice >= 10000000) {
							showProduct = false;
						}
					} else if (price === '100000000') { // Trên 100,000,000
						if (productPrice <= 100000000) {
							showProduct = false;
						}
					} else {
						var priceRange = price.split('-');
						if (priceRange.length === 2) {
							var minPrice = parseFloat(priceRange[0]);
							var maxPrice = parseFloat(priceRange[1]);
							if (productPrice < minPrice || productPrice > maxPrice) {
								showProduct = false;
							}
						}
					}
				}

				if (searchQuery && !productName.includes(searchQuery)) {
					showProduct = false;
				}

				if (showProduct) {
					$(this).fadeIn();
				} else {
					$(this).fadeOut();
				}
			});
		}

		$('#gemFilter, #priceFilter').on('change', function () {
			filterProducts();
		});

		$('#searchInput').on('input', function () {
			filterProducts();
		});

		$('#searchButton').on('click', function () {
			filterProducts();
		});

		filterProducts();

	});
</script>